train <- read.csv("data_stepcox_train.csv")
test <- read.csv("data_stepcox_test.csv")
gse19234 <- read.csv("data_stepcox_gse19234.csv")
gse65904 <- read.csv("data_stepcox_gse65904.csv")
gse98394 <- read.csv("data_stepcox_gse98394.csv")

set.seed(123)
cv.plsRcox.res=cv.plsRcox(list(x=train[,c(-1,-2)],time=train$OS.time,status=train$OS),nt=10,verbose = FALSE)
fit <- plsRcox(train[,c(-1,-2)],time=train$OS.time,event=train$OS,nt=as.numeric(cv.plsRcox.res[5]))
RS_train=as.numeric(predict(fit,type="lp",newdata=train[,-c(1,2)]))
RS_test=as.numeric(predict(fit,type="lp",newdata=test[,-c(1,2)]))
RS_gse19234=as.numeric(predict(fit,type="lp",newdata=gse19234[,-c(1,2)]))
RS_gse65904=as.numeric(predict(fit,type="lp",newdata=gse65904[,-c(1,2)]))
RS_gse98394=as.numeric(predict(fit,type="lp",newdata=gse98394[,-c(1,2)]))
data_train = cbind(train,score=RS_train)
data_test = cbind(test,score=RS_test)
data_gse19234 = cbind(gse19234,score=RS_gse19234)
data_gse65904 = cbind(gse65904,score=RS_gse65904)
data_gse98394 = cbind(gse98394,score=RS_gse98394)
write.csv(data_train,'stepcox_plsRcox_train.csv')
write.csv(data_test,'stepcox_plsRcox_test.csv')
write.csv(data_gse19234,'stepcox_plsRcox_gse19234.csv')
write.csv(data_gse65904,'stepcox_plsRcox_gse65904.csv')
write.csv(data_gse98394,'stepcox_plsRcox_gse98394.csv')